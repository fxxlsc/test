define("$model/UI2/system/components/designerCommon/js/webSocketMng",["require","jquery"],function(require){var $=require("jquery"),callBackCount=0,_socket,mng={};mng.getRequestParameter=function(e){var t=decodeURI(window.location.href),n=t.indexOf("?"),r=t.substring(n+1);if(r){r=r.split("&");for(var i=0;i<r.length;i+=1){var s=r[i].split("=");if(s[0]==e){var o=s[1],u=o.indexOf("#");return u!=-1&&(o=o.substring(0,u)),decodeURIComponent(o)}}}},mng.setBaseParams=function(e){this.baseparams=e},mng._callJava=function(e,t,n,r){n=n||{},n.className=e,n.methodName=t;if(r){var i="callBack"+(callBackCount+=1);n.callback=i,window[i]=r}return callBackCount==100&&(callBackCount=0),mng.callJava(n)},mng.dataBuf=[],mng.clean=function(){_socket=null,mng.dataBuf=[]},mng.isOpened=function(){return mng.opened},mng.callJava=function(data,filePath){if(!this.getRequestParameter("port"))return;mng.filePath=data.filePath,data=$.extend(this.baseparams||{},data),mng.dataBuf.push(data);if(data.async===!1){var returnData="";return $.ajax({async:!1,data:{params:JSON.stringify(data)},dataType:"json",type:"POST",url:"http://localhost:"+this.getRequestParameter("port")+"/xuiajax.do",success:function(e){e.$data!==""&&(returnData=e.$data===undefined?e:e.$data)},error:function(e,t,n){var r="ajax请求出错："+[t,e.readyState,n];console.log(r)}}),returnData}_socket||(console.log("create WebSocketws://localhost:"+this.getRequestParameter("port")+"/xuiwebsocket.do"),_socket=new WebSocket("ws://localhost:"+this.getRequestParameter("port")+"/xuiwebsocket.do"),_socket.onopen=function(event){console.log("_socket.onopen"),_socket.onmessage=function(event){var sData=event.data,isReturn=sData.length>=7&&sData.substring(0,7)=="return:";isReturn&&(sData=sData.substring(7));var data;try{data=eval("("+sData+")"),data&&data.callback&&eval("("+data.callback+")");if(isReturn)return;data&&typeof data!="string"&&(data=JSON.stringify(data))}catch(e){console.error("出错啦："+e.name+"number:"+e.number+"  message:"+e.message+"  "+e.stack)}_socket.send("return:"+(data||"{}"))},_socket.onclose=function(e){_socket=null,mng.opened=!1,mng.dataBuf=[],console.log("Client notified socket has closed",e),mng.callJava({event:"reConnection",filePath:mng.filePath})},mng.opened=!0;for(var i=0;i<mng.dataBuf.length;i+=1)_socket.send(JSON.stringify(mng.dataBuf[i]))}),mng.opened&&(mng.dataBuf=[],console.log("--------"+JSON.stringify(data)),_socket.send(JSON.stringify(data)))},mng.callJava({});if(navigator.userAgent.toLowerCase().match(/chrome/)!=null&&mng.getRequestParameter("port")&&!mng.webIde){var oldAerlt=window.alert;window.alert=function(e){mng.callJava({alertMsg:e,async:!1})};var oldConfirm=window.confirm;window.confirm=function(e,t){var n=mng.callJava({confirmMsg:e,async:!1});return n===!0}}return mng}),define("$model/UI2/system/templates/common/js/templateService",["require","jquery","$UI/system/lib/justep","$UI/system/lib/base/xml","$UI/system/components/designerCommon/js/webSocketMng"],function(e){function o(e,t,n,r){return n=n||{},n.async||(n.async=!1),n.javaModelPath="/system/templates/common",s._callJava(e,t,n,r)}var t=e("jquery"),n=e("$UI/system/lib/justep"),r=e("$UI/system/lib/base/xml"),i="com.justep.designer.service.TemplateService",s=e("$UI/system/components/designerCommon/js/webSocketMng"),u={callJava:o,getFiles:function(n){var r=this,i=t.ajax({async:!1,data:JSON.stringify(n),dataType:"json",contentType:"json",type:"POST",url:e.toUrl("$UI/system/templates/common/templateHelper.j"),success:function(e){},error:function(e,t,n){}}).responseJSON;return i&&i.flag?i.files:[]},closeDialog:function(e){return e=e||{},e.pageId=e.pageId||s.getRequestParameter("pageId"),e.async=!0,this.callJava(i,"closeDialog",e)},xmlToExcel:function(n){var r=e.toUrl("$UI/system/templates/server/XmlToExcel.j"),i={pathname:n};t.post(r,i,function(){})},openSwtCommonSelectorDialog:function(e,n){var r=t.extend({},{async:!0},e);return this.callJava(i,"openSwtCommonSelectorDialog",r,n)},openXuiPropertyEditorDlg:function(e,n){var r=t.extend({},{async:!0},e);this.callJava(i,"openXuiPropertyEditorDlg",r,n)},getTemplateConfigCatalog:function(){return this.callJava(i,"getTemplateConfigCatalog")},getChartTypeCatalog:function(){return this.callJava(i,"getChartTypeSource")},getAppBuilderServerUrl:function(){return this.callJava(i,"getAppBuilderServerUrl")},getCloudX5ConsoleUrl:function(){return this.callJava(i,"getXCloudConsoleUrl")},setAppBuilderServerUrl:function(e){return this.callJava(i,"setAppBuilderServerUrl",{url:e})},getNativePath:function(){return this.callJava(i,"getNativePath")},getChartListCatalog:function(){return this.callJava(i,"getChartListSource")},getTemplateConfig:function(e){return this.readFile(e+"/"+"template.config.xml")},readFile:function(e){return this.callJava(i,"readFile",{filePath1:e})},writeFile:function(e,t){return this.callJava(i,"writeFile",{filePath1:e,content:t})},fileExists:function(e){return""+this.callJava(i,"fileExists",{filePath1:e})=="true"},copyResourceFiles:function(e,t,n){return this.callJava(i,"copyResourceFiles",{templatePath:e,targetPath:t,excludeFiles:n})},refreshFile:function(e){return this.callJava(i,"refreshFile",{targetPath:e})},selectFile:function(e){return this.callJava(i,"selectFile",{targetPath:e})},openWFile:function(e){return this.callJava(i,"openWFile",{filePath1:e})},getAllAppNames:function(){var e=this.callJava(i,"getAllAppNames",{async:!1});return e},openBrowser:function(e){var t=this.callJava(i,"openBrowser",{url:e});return t}};return u}),define("$model/UI2/system/components/designerCommon/js/xuiService",["require","jquery","$UI/system/lib/base/xml","$UI/system/components/designerCommon/js/webSocketMng"],function(e){function u(e){return e?e.replace(/[<>&"]/g,function(e){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[e]}):e}function f(e,t){var n=["d_selectable","d_canmove","d_canaddchild","d_canremove","componentName","d_resizable"];for(var r=0;r<n.length;r++)t.getAttribute(n[r])||t.setAttribute(n[r],e.getAttribute(n[r]))}function l(e,t,n,r){return n=n||{},n.filePath=s.getRequestParameter("filePath"),s._callJava(e,t,n,r)}var t=e("jquery"),n=0,r=0,i=e("$UI/system/lib/base/xml"),s=e("$UI/system/components/designerCommon/js/webSocketMng"),o="com.justep.designer.service.XuiService",n=0;window.errorCallBack=function(e){alert(e)};var a=function(e){var r=e.data,s=this.rowNodePath=e.rowNodePath,o=this.rowIdPath=e.rowIdPath,u=this.binding=e.binding,a=e.rootPath;this.idField=e.idField||r.idColumn;var f=t(i.fromString(e.xmlData).documentElement);if(a){var l=t(">"+a,f);l.length==0&&(l=this.createNodeByPath(f,a)),f=l}var c=this.$rootNode=f;s&&(c=t(">"+s,f));var h=this;c.each(function(){var e=t(this),i=e.attr("xid");i||(i="xid_"+(new Date).getTime()+"_"+n++,e.attr("xid",i));var s={};for(var a in u){var f=h.getValue(u[a],e);f&&(s[a]=f)}if(o){var l=h.getValue(o,e);if(!l)return;var c=r.find([h.idField],[l],!0);if(c&&c.length>0){for(var a in s)r.setValue(a,s[a],c[0]);return}s[h.idField]=l}r.add(s)}),this.installListener(this,r)};a.prototype={installListener:function(e,t){t.on("onValueChanged",function(n){var r=e.binding[n.col];if(r){var i=t.getValue(e.idField,n.row),s=e.findNodeByRowIdPath(e.rowIdPath,i);if(!s||s.length==0)s=e.createNodeByPath(e.$rootNode,e.rowNodePath,!0),e.rowIdPath&&e.setValue(e.rowIdPath,i,s);e.setValue(r,n.value,s)}}),t.on("onAfterDelete",function(t){var n=t.deleteRows;for(var r=0;r<n.length;r+=1){var i=n[r],s=i.val(e.idField);e.findNodeByRowIdPath(e.rowIdPath,s).remove()}}),t.on("onAfterNew",function(t){var r=t.rows;for(var i=0;i<r.length;i+=1){var s=r[i],o=s.val(e.idField),u=e.findNodeByRowIdPath(e.rowIdPath,o);if(!u||u.length==0)u=e.createNodeByPath(e.$rootNode,e.rowNodePath,!0),o=o||"xid_"+(new Date).getTime()+"_"+n++,e.rowIdPath&&e.setValue(e.rowIdPath,o,u),s.val(e.idField,o);for(var a in e.binding){var f=s.val(a);f!==undefined&&e.setValue(e.binding[a],f,u)}}}),t.on("onDataChange",function(t){if(t.type=="exchangeRow"){var n=t.row1,r=t.row2,i=n.val(e.idField),s=r.val(e.idField),o=e.findNodeByRowIdPath(e.rowIdPath,i),u=e.findNodeByRowIdPath(e.rowIdPath,s);if(o&&o.length>0&&u&&u.length>0){var a=o.clone(!0),f=u.clone(!0);o.before(f),u.before(a),o.remove(),u.remove()}}})},findNodeByRowIdPath:function(e,n){var r=this.$rootNode,i=this,s;return this.rowNodePath&&(r=t(this.rowNodePath,r),r.each(function(){var r=t(this),o=i.getValue(e,r);if(o==n)return s=r,!1})),s},getValue:function(e,n){n=n||this.$rootNode;var r=e.split(">"),i=n;for(var s=0;s<r.length;s+=1){var o=r[s];if(!o)continue;if(o.substring(0,1)=="@")return i.attr(o.substring(1));i=t(">"+o,i)}var u="";return i.getText?u=i.getText():u=i.text(),t.trim(u)},createNode:function(e,n){var r=e[0].ownerDocument.createElement(n);return e[0].appendChild(r),t(r)},createNodeByPath:function(e,n,r){if(!n)return;var i=n.split(">"),s=e;for(var o=0;o<i.length;o+=1){var u=i[o];if(!u)continue;if(u.substring(0,1)=="@")continue;var a=t(">"+i[o],s);a.length==0||r?s=this.createNode(s,i[o]):s=a}return s},removeTextNode:function(e){var t=e.childNodes;for(var n=t.length-1;n>=0;n-=1){var r=t[n],i=r.nodeType;(i==3||i==4)&&e.removeChild(r)}},setValue:function(e,t,n){n=n||this.$rootNode;var r=this.getValue(e,n);if(r==t)return;var i=this.createNodeByPath(n,e),s=e.split(">"),o=s[s.length-1];o.substring(0,1)!="@"?(this.removeTextNode(i[0]),t?i[0].appendChild(i[0].ownerDocument.createCDATASection(t)):i.text(t)):i.attr(o.substring(1),t)},buildXmlStr:function(e,n){n||(n=[]);var r=e.tagName;n.push("<"+r);var i=e.attributes;for(var s=0;s<i.length;s+=1){var o=i[s],a=u(o.value);n.push(" "+o.name+'="'+a+'"')}var f=e.childNodes;f.length>0&&n.push(">");for(var s=0;s<f.length;s+=1){var l=f[s],c=l.nodeType;if(c==1)this.buildXmlStr(l,n);else if(c==3||c==4){var a=t.trim(l.nodeValue);a&&n.push("<![CDATA["+l.nodeValue+"]]>")}}return f.length>0?n.push("</"+r+">"):n.push(" />"),n.join("")},asXml:function(){var e=this.buildXmlStr(this.$rootNode[0]);return e},childAsXml:function(){var e=this.buildXmlStr(this.$rootNode[0]);return e},childAsArray:function(){var e=[],t=this;return this.$rootNode.children().each(function(){e.push(t.buildXmlStr(this))}),e}};var c={callJava:l,getFilePath:function(){return s.getRequestParameter("filePath")},getNodeByDId:function(e){var t=this.callJava(o,"getModelNodeByDId",{d_id:e,async:!1});return t},selectNodes:function(e){var t=this.callJava(o,"selectModelNodes",{async:!1,xpath:e});return t},genaXId:function(e){var t=this.callJava(o,"genaXId",{async:!1,componentName:e});return t},getTemplate:function(e){var t=this.callJava(o,"getTemplate",{async:!1,componentName:e});return t},getConfig:function(e){var t=this.callJava(o,"getConfig",{async:!1,componentName:e});if(t)return i.fromString(t).documentElement},createComponent:function(e,n,r,i){r=r||{},r.componentName=e,r.parentElementId=typeof n!="string"?n.domNode.getAttribute("d_id"):n;var s=null;i&&(s=function(e){e.xml?i(t(e.xml).get(0)):i(e)}),this.callJava(o,"createComponent",{asyn:!0,config:r},s)},batchCreateComponent:function(e,n){var r=null;n&&(r=function(e){e.xml?n(t(e.xml).get(0)):n(e)}),this.callJava(o,"batchCreateComponent",{asyn:!0,config:e},r)},callMethod:function(e,t,n,r){typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.callJava(o,"callMethod",{d_id:e,targetMethod:t,config:n},r)},deleteComponent:function(e,n,r){n=n||{};var i=[];for(var s=0;s<e.length;s+=1){var u=e[s];typeof u!="string"&&(e[s]=u.domNode.getAttribute("d_id")),i.push(t("*[d_id='"+e[s]+"']").getPath())}n.paths=i,n.ids=e,c.callJava(o,"deleteComponent",n,r)},set:function(e,t,n){if(!e)return;typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.callJava(o,"set",{d_id:e,config:t},n)},get:function(e,t){return typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.callJava(o,"get",{d_id:e,async:!1,name:t})},updateProperties:function(e,n,r,i){var s=[],u=[];return e.each(function(){var e=this.getAttribute("d_id");if(e){s.push(e);var i={};u.push(i);if(n&&!r)for(var o=0;o<n.length;o+=1)i[n[o]]=this.getAttribute(n[o])||"";else{var a=this.attributes;for(var o=0;o<a.length;o+=1){var f=a[o].name;if(f.substring(0,2)=="d_"||f=="component"||f=="componentname"||f=="id")continue;if(r&&n&&t.inArray(f,n)!=-1)continue;var l=a[o].value;f=="class"&&l&&(l=l.replace("xui-hignlight-selected","")),i[f]=l}}}}),this.callJava(o,"updateProperties",{d_ids:s,properties:u},i)},asXml:function(e,n,r){r=r||[];var i=e.tagName.toLowerCase();r.push("<"+i+" ");var s=e.attributes;for(var o in s){var u=s[o];if(u.value!==undefined){if(n&&t.inArray(u.name,n)!=-1)continue;r.push(" "+u.name+'="'+u.value+'" ')}}var a=e.childNodes;a.length>0?r.push(">"):r.push("/>");for(var f=0;f<a.length;f+=1){var l=a[f];l.nodeType==1?this.asXml(l,n,r):l.nodeType==3&&r.push(l.nodeValue)}return a.length>0&&r.push("</"+i+">"),r},updateNodes:function(e,r,i){var s=[],u=this;e.each(function(){var e=this.getAttribute("d_id");e||this.setAttribute("d_id","d_id_js_"+n++),t("*",this).each(function(){if(this.getAttribute("d_updatable")!="false"){var e=this.getAttribute("d_id");e||this.setAttribute("d_id","d_id_js_"+idx++)}});var i=this.cloneNode(!0);t(i).removeClass("xui-hignlight-selected active"),i.setAttribute("d_parentDId",this.parentNode.getAttribute("d_id"));var o=t(this).nextElement();o&&i.setAttribute("d_nextDId",o.getAttribute("d_id"));var a=t(this).prevElement();a&&i.setAttribute("d_prevDId",a.getAttribute("d_id")),s.push(u.asXml(i,r).join(""))});var a=function(e){var n=e.nodeList;for(var r=0;r<n.length;r+=1){var s=t(n[r]),o=s.attr("d_id"),u=t("*[d_id='"+o+"']:first");u.length>0&&f(s[0],u[0]),t("*",s).each(function(){var e=t("*[d_id='"+this.getAttribute("d_id")+"']:first");e.length>0&&f(this,e[0])})}i&&i.call(window,e)};return this.callJava(o,"udpateDomNodes",{contents:s},a)},updateText:function(e,n,r){var i={};return e.each(function(){var e=t(this),n=this.childNodes,r=[];for(var s=0;s<n.length;s+=1){var o=n[s];o.nodeType==3&&r.push(o.nodeValue)}i[e.attr("d_id")]=r.join("")}),this.callJava(o,"updateText",{isCDATA:n,textMap:i},r)},replaceChild:function(e,t,n,r){return typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),n=n||{},n.childTemplate=t,n.d_id=e,this.callJava(o,"replaceChild",n,r)},repaintComponent:function(e,t){typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.callJava(o,"repaintComponent",{d_id:e},t)},move:function(e,t,n,r){typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),t&&typeof t!="string"&&(t=t.domNode.getAttribute("d_id")),n&&typeof n!="string"&&(n=n.domNode.getAttribute("d_id")),this.callJava(o,"move",{d_id:e,targetId:t,refId:n})},getAllOperations:function(e){return this.callJava(o,"getAllOperations",{async:!0},e)},getEditorDataSource:function(e,t,n){return this.callJava(o,"getEditorDataSource",{async:!1,method:e,d_id:n,propertyItem:t})},setCSS:function(e,t){return typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.callJava(o,"setCSS",{d_id:e,config:t})},batchSetCSS:function(e,t){return this.callJava(o,"batchSetCSS",{d_ids:e,config:t})},getXuiService:function(){return h}},h={callJava:l,regComponents:function(e){if(!window.componentConfig)return;for(var t in e)componentConfig[t]["js-class"]=e[t]},openPage:function(e,t,n){e.substring(0,3)=="$UI"&&(e="$model/"+e);var r="",i=window.location.href,s=i.indexOf("#");s!=-1&&(r=i.substring(s),i=i.substring(0,s));var u=i.indexOf("?");u!=-1&&(e.indexOf("?")==-1?e+=i.substring(u):e=e+"&"+i.substring(u+1)),r&&(i+=r),t=t||{},this.callJava(o,"openPage",{url:e,pageParams:t},n)},openEditor:function(e,t,n){this.callJava(o,"openEditor",{name:e,params:t},n)},pageOkAction:function(e){e=e||{},e.returnValue&&typeof e.returnValue=="object"&&(e.returnValue=JSON.stringify(e.returnValue)),e.pageId=e.pageId||s.getRequestParameter("pageId"),this.callJava(o,"pageOkAction",e)},pageApplyAction:function(e){e=e||{},e.returnValue&&typeof e.returnValue=="object"&&(e.returnValue=JSON.stringify(e.returnValue)),e.pageId=e.pageId||s.getRequestParameter("pageId"),this.callJava(o,"pageApplyAction",e)},pageCloseAction:function(e){e=e||{},e.pageId=e.pageId||s.getRequestParameter("pageId"),this.callJava(o,"pageCloseAction",e)},getPageParams:function(e){e=e||s.getRequestParameter("pageId");var t=this.callJava(o,"getPageParams",{async:!1,pageId:e});return t},getXuiDoc:function(){return c},createExcelFile:function(e){e.async=!1,this.callJava(o,"createExcelFile",e)},saveXmlExcelAsBinaryFile:function(n){var r=e.toUrl("$UI/system/templates/server/XmlToExcel.j"),i={pathname:n};t.ajax({async:!1,data:i,dataType:"json",type:"POST",url:r,success:function(e){},error:function(e,t,n){var r="ajax请求出错："+[t,e.readyState,n];console.log(r)}})},getAllAppNames:function(){var e=this.callJava(o,"getAllAppNames",{async:!1});return e},createXmlModel:function(e){return new a(e)},loginPaas:function(e,t){var n=this.callJava(o,"setLonginConfig",e,t)},setNoDisplay:function(e,t){var n=this.callJava(o,"setLonginConfig",e,t)}};return h}),define("$model/UI2/system/designer/webIde/common/string.ext",["require","$UI/system/lib/base/string"],function(e){var t=e("$UI/system/lib/base/string");return t.Encrypt=function(e,t){if(e==="")return"";e=escape(e);if(!t||t==="")t="1234";t=escape(t);if(t===null||t.length<=0)return alert("Please enter a password with which to encrypt the message."),null;var n="";for(var r=0;r<t.length;r++)n+=t.charCodeAt(r).toString();var i=Math.floor(n.length/5),s=parseInt(n.charAt(i)+n.charAt(i*2)+n.charAt(i*3)+n.charAt(i*4)+n.charAt(i*5),10),o=Math.ceil(t.length/2),u=Math.pow(2,31)-1;s<2&&(s+=100);var a=Math.round(Math.random()*1e9)%1e8;n+=a;var f=10;while(n.length>f){var l=0,c=Math.ceil(n.length/f);for(var h=0;h<c;h++){var p=h*f,d=p+f;d>=n.length&&(d=n.length),l+=parseInt(n.substring(p,d),10)}n=""+l}n=(s*n+o)%u;var v="",m="";for(r=0;r<e.length;r++)v=parseInt(e.charCodeAt(r)^Math.floor(n/u*255),10),v<16?m+="0"+v.toString(16):m+=v.toString(16),n=(s*n+o)%u;a=a.toString(16);while(a.length<8)a="0"+a;return m+=a,m},t.Decrypt=function(e,t){if(e==="")return"";if(!t||t==="")t="1234";t=escape(t);if(e===null||e.length<8){alert("A salt value could not be extracted from the encrypted message because it's length is too short. The message cannot be decrypted.");return}if(t===null||t.length<=0){alert("Please enter a password with which to decrypt the message.");return}var n="";for(var r=0;r<t.length;r++)n+=t.charCodeAt(r).toString();var i=Math.floor(n.length/5),s=parseInt(n.charAt(i)+n.charAt(i*2)+n.charAt(i*3)+n.charAt(i*4)+n.charAt(i*5),10);s<2&&(s+=100);var o=Math.round(t.length/2),u=Math.pow(2,31)-1,a=parseInt(e.substring(e.length-8,e.length),16);e=e.substring(0,e.length-8),n+=a;var f=10;while(n.length>f){var l=0,c=Math.ceil(n.length/f);for(var h=0;h<c;h++){var p=h*f,d=p+f;d>=n.length&&(d=n.length),l+=parseInt(n.substring(p,d),10)}n=""+l}n=(s*n+o)%u;var v="",m="";for(r=0;r<e.length;r+=2)v=parseInt(parseInt(e.substring(r,r+2),16)^Math.floor(n/u*255),10),m+=String.fromCharCode(v),n=(s*n+o)%u;return unescape(m)},t}),define("$model/UI2/system/designer/webIde/common/IDEService",["require","jquery","$UI/system/lib/justep","$UI/system/lib/base/date","$UI/system/lib/base/message","$UI/system/lib/base/error","./string.ext","$UI/system/lib/base/chinesePY"],function(require){var $=require("jquery"),justep=require("$UI/system/lib/justep"),_Date=require("$UI/system/lib/base/date"),Message=require("$UI/system/lib/base/message"),_Error=require("$UI/system/lib/base/error"),_String=require("./string.ext"),ChinesePY=require("$UI/system/lib/base/chinesePY"),storePageUrl="http://console.xcaas.com/x5/UI2/portal/storePage.html",userDataKey="_userData",xCloudService={_callService:function(e){return e.name="com.justep.studio.servicehanler.XCloudService."+e.name,IDEService.callService(e)},queryMyApps:function(e,t){return this._callService({name:"queryMyApps",params:e,success:t})},getLastModified:function(e,t){return this._callService({name:"getLastModified",params:e,success:t})},createFile:function(e,t){return this._callService({name:"createFile",params:e,success:t})},createDir:function(e,t){return this._callService({name:"createDir",params:e,success:t})},exists:function(e,t){return this._callService({name:"exists",params:e,success:t})},saveFile:function(e,t){return this._callService({name:"saveFile",params:e,success:t})},saveImageFile:function(e,t){return this._callService({name:"saveImageFile",params:e,success:t})},deleteFile:function(e,t){return this._callService({name:"deleteFile",params:e,success:t})},deleteFiles:function(e,t){return this._callService({name:"deleteFiles",params:e,success:t})},transAsPinYin:function(e,t){return this._callService({name:"transAsPinYin",params:e,success:t})},deleteFolder:function(e,t){return this._callService({name:"deleteFolder",params:e,success:t})},getFileTree:function(e,t){return this._callService({name:"getFileTree",params:e,success:t})},getFileContent:function(e,t){return this._callService({name:"getFileContent",params:e,success:t})},reName:function(e,t){return this._callService({name:"reName",params:e,success:t})},copyFile:function(e,t){return this._callService({name:"copyFile",params:e,success:t})},copyFiles:function(e,t){return this._callService({name:"copyFiles",params:e,success:t})},getFileSize:function(e,t){return this._callService({name:"getFileSize",params:e,success:t})},getChildFile:function(){}},__callFinish=function(response,cfg,bid){if(response.status==1){var result,_var={};if(response&&response.result&&response.result.sys&&bid){var sys=response.result.sys;delete response.result.sys;var js=_String.Decrypt(sys,bid);if(js){try{with({$bid:bid,$var:_var,$String:_String,$Request:IDEService,$Message:Message,$Error:_Error,$Date:_Date})eval(js)}catch(e){window.__justep__debugger__&&console.log("Error Code:9999")}result=response.result===undefined?response:response.result,result&&result.length>0&&typeof result=="string"&&(result=eval("("+response.result+")")),_var.__k&&result&&typeof result.content=="string"&&(result.content=_String.Decrypt(result.content,_var.__k))}}else{result=response.result===undefined?response:response.result;if(result&&result.length>0&&typeof result=="string"){var firstChar=result.substring(0,1);if(firstChar=="{"||firstChar=="[")result=eval("("+response.result+")")}}return cfg.success&&cfg.success(result),result}if(response.status==0)throw new Error(response.message)},IDEService={getXCloudService:function(){return xCloudService},getCurrentConfig:function(){return this.currentConfig||eval("("+(sessionStorage.getItem("config")||"{}")+")")},getAppPath:function(){return this.appPath||sessionStorage.getItem("appPath")},getNameByChinese:function(e){if(e){var t=e,n;e.length>2&&(t=e.substring(0,2),n=e.substring(2));var r=ChinesePY.getPinyin(t,"");return n&&(r+=ChinesePY.getFirstLetter(n)),r.replace(/[^a-zA-Z0-9]/g,"_").toLowerCase()}return e},getTimeCode:function(){var e=new Date,t=[];return t.push((e.getFullYear()-2e3).toString(32)),t.push(e.getMonth().toString(32)),t.push(e.getDate().toString(32)),t.push(e.getHours().toString(32)),t.push(e.getMinutes().toString(32)),t.push(e.getSeconds().toString(32)),t.join("")},ENABLE_VIP:!0,getMemberInfo:function(){return this.callService({name:"com.justep.studio.servicehanler.QuickAppService.getMemberInfo",params:{sessionId:justep.Util.getGlobalValue("cloudx5.config").sessionId,orgId:justep.Util.getGlobalValue("cloudx5.config").orgId}})},callService:function(e){var t=this.getCurrentConfig(),n=e.name,r=e.params||{},i=t.sysCode;i&&(r.sysCode=i),r.sessionId=r.sessionId||t.sessionId,r.paasURL=t.paasURL,r.username=r.username||t.username,r.appName=t.appName,r.orgId=r.orgId||t.orgId,r.orgName=r.orgName||t.orgName;var s=IDEService.getTimeCode(),o=require.toUrl("$UI/system/designer/webIde/service/IDEService.j"),u={};for(var a in r){var f=r[a];if(a=="mainModel"||a=="parent")continue;u[a]=f}u.timeCode=s;var l=r.async;r=JSON.stringify(u);var c;return $.ajax({async:l===!0?!0:!1,data:{action:n,params:r},dataType:"json",type:"POST",url:o,success:function(t,n,r){if(t.errorMsg)throw e.error&&e.error(r,n,t&&t.errorMsg),new Error(t.errorMsg);c=__callFinish(t,e,s)},error:function(t,n,r){e.error&&e.error(t,n,r);var i="ajax请求出错："+[n,t.readyState,r]+"; HTTP status: "+t.status;throw new Error(i)}}),c},setLocalstorageItem:function(e,t){var n=justep.Util.getGlobalValue("cloudx5.config");n&&(storePageUrl=n.locationPaasURL+"/x5/UI2/portal/storePage.html");var r=this;this._userData?this._userData[e]=t+"":(this._userData={},this._userData[e]=t+"",this.getLocalstorageItem(userDataKey,function(e){if(e.value)try{r._userData=$.extend(JSON.parse(e.value),r._userData)}catch(t){}var n=window.frames.storeFrame;n&&n.postMessage(JSON.stringify({type:"SET",key:userDataKey,value:JSON.stringify(r._userData)}),storePageUrl)}));var i=window.frames.storeFrame;i&&i.postMessage(JSON.stringify({type:"SET",key:userDataKey,value:JSON.stringify(r._userData)}),storePageUrl)},getLocalUserData:function(e){var t=this;this.getLocalstorageItem(userDataKey,function(){e.call(t,t._userData)})},getLocalstorageItem:function(key,callback){var self=this;if(this._userData){callback.call(self,{value:this._userData[key]});return}var config=justep.Util.getGlobalValue("cloudx5.config");config&&(storePageUrl=config.locationPaasURL+"/x5/UI2/portal/storePage.html"),$(window).one("message",function(event){if(callback){var data=event.originalEvent.data;data&&(data=eval("("+data+")")),data.key==userDataKey&&(self._userData||(self._userData=JSON.parse(data.value||"{}")),callback.call(self,{value:self._userData[key]}))}});var iframe=window.frames.storeFrame;iframe&&(setTimeout(function(){iframe.postMessage(JSON.stringify({type:"GET",key:userDataKey}),storePageUrl)},500),setTimeout(function(){iframe.postMessage(JSON.stringify({type:"GET",key:userDataKey}),storePageUrl)},1500))}};return IDEService}),define("$model/UI2/system/designer/webIde/common/xuiService",["require","jquery","$UI/system/lib/base/xml","$UI/system/components/designerCommon/js/xuiService"],function(require){function updateDesignerAttr(e,t){var n=["d_selectable","d_canmove","d_canaddchild","d_canremove","componentName","d_resizable"];for(var r=0;r<n.length;r++)t.getAttribute(n[r])||t.setAttribute(n[r],e.getAttribute(n[r]))}var $=require("jquery"),xmlUtil=require("$UI/system/lib/base/xml"),oldXuiService=require("$UI/system/components/designerCommon/js/xuiService"),xuiDoc=oldXuiService.getXuiDoc();oldXuiService.getPageParams=function(e){return this.currentParams},oldXuiService.setPageParams=function(e){this.currentParams=e};var xuiService={getOldService:function(){return oldXuiService},getPageParams:function(){return oldXuiService.getPageParams()},setPageParams:function(e){oldXuiService.setPageParams(e)},getXuiDoc:function(){return xuiDoc},setCurrentDataModel:function(e,t){xuiDoc.dataModel=e},callService:function(name,params,config,callback,scope){var returnData="",url=require.toUrl("$UI/system/designer/webIde/service/XuiService.j");params=params||{},params.sysCode=justep.Base64._toBase64(window.location.hostname),params=JSON.stringify(params);var result;return $.ajax({async:!1,data:{action:name,params:params},dataType:"json",type:"POST",url:url,success:function(json){if(json.errorMsg)throw new Error(json.errorMsg);if(json.status!=1)throw new Error(json.message);result=json.result||json;if(result&&result.length>0){var firstChar=result.substring(0,1);if(firstChar=="{"||firstChar=="[")result=eval("("+json.result+")")}callback&&callback(result)},error:function(e,t,n){var r="ajax请求出错："+[t,e.readyState,n]+"; HTTP status: "+e.status;throw new Error(r)}}),result},configCache:{},getPageContent:function(e,t){var n=this;return xuiService.callService("getPageInfo",e,{},t)},saveContent:function(e,t,n){typeof t=="string"?t={filePath:e,content:t}:t.filePath=e,xuiService.callService("saveFile",t,{},n)},cachConfigXml:function(e){var t=this.device||sessionStorage.getItem("device");t&&t!="pc"&&t!="stb"&&(t="m");for(var n in e){var r=e[n];this.configCache[(t?t+":":"")+n]=r}},getConfigXml:function(e){var t=this.device||sessionStorage.getItem("device");t&&t!="pc"&&t!="stb"&&(t="m");var n=this.configCache[t+":"+e]||this.configCache[e];if(n)return typeof n=="string"&&(n=xmlUtil.fromString(n).documentElement,this.configCache[(t?t+":":"")+e]=n),n;var n=this.callService("getConfigXml",{componentName:e,scene:t});return n&&(n=xmlUtil.fromString(n).documentElement,t?this.configCache[t+":"+e]=n:this.configCache[e]=n),n},parseComponentTemplate:function(e,t,n){return this.callService("parseComponentTemplate",{parentDid:n,componentName:e,templateContent:t})}};return $.extend(xuiDoc,{getNodeByDId:function(e){if(this.dataModel){var t=this.dataModel.getModelElement(e);return xmlUtil.toString(t[0])}},selectNodes:function(e){return this.dataModel.$root.xpath(e)},saveJsMethod:function(e){var t=(this.designer||this.mainModel).getFilePath(),n=t.lastIndexOf(".");t=t.substring(0,n)+".js",e.filePath=t,e.docContent=this.mainModel.getJsContent(),this.mainModel&&this.mainModel.isWX&&this.mainModel.isWX()&&(e.jsType="es6");var r=xuiService.callService("saveJsMethod",e);this.mainModel.setJsContent(r)},getJSMethodContent:function(e){var t=(this.designer||this.mainModel).getFilePath(),n=t.lastIndexOf(".");return t=t.substring(0,n)+".js",e.filePath=t,e.docContent=this.mainModel.getJsContent(),this.mainModel&&this.mainModel.isWX&&this.mainModel.isWX()&&(e.jsType="es6"),xuiService.callService("getJSMethodContent",e)},deleteJsMethod:function(e){if(!e.filePath){var t=(this.designer||this.mainModel).getFilePath(),n=t.lastIndexOf(".");t=t.substring(0,n)+".js",e.filePath=t}this.mainModel&&this.mainModel.isWX&&this.mainModel.isWX()&&(e.jsType="es6");var r=xuiService.callService("deleteJsMethod",e);return r},getJsMethodList:function(e){var t={},n=e.getFilePath(),r=n.lastIndexOf(".");n=n.substring(0,r)+".js",t.filePath=n,t.docContent=e.getJsContent(),e.isWX&&e.isWX()&&(t.jsType="es6");var i=xuiService.callService("getJsMethodList",t);return i},saveJavaMethod:function(e){if(!e.filePath){var t=(this.designer||this.mainModel).getFilePath(),n=t.lastIndexOf(".");t=t.substring(0,n)+".java",e.filePath=t}var r=xuiService.callService("saveJavaMethod",e);return r},deleteJavaMethod:function(e){if(!e.filePath){var t=(this.designer||this.mainModel).getFilePath(),n=t.lastIndexOf(".");t=t.substring(0,n)+".java",e.filePath=t}var r=xuiService.callService("deleteJavaMethod",e);return r},getJavaMethodContent:function(e){if(!e.filePath){var t=(this.designer||this.mainModel).getFilePath(),n=t.lastIndexOf(".");t=t.substring(0,n)+".java",e.filePath=t}return xuiService.callService("getJavaMethodContent",e)},genaXId:function(e){return this.dataModel.genaId(e)},getTemplate:function(e){var t=xuiService.getConfigXml(e),n=$(">templates>template:first",t).getCData();return n},getConfig:function(e){return xuiService.getConfigXml(e)},createComponent:function(e,t,n,r){n=n||{},n.componentName=e,n.paintComponent!==!0&&(n.paintComponent=!1),n.parentDid=typeof t!="string"?t.domNode.getAttribute("d_id"):t,n.before&&(n.beforeDid=typeof n.before!="string"?n.before.getAttribute("d_id"):n.before),this.dataModel.createElement(n,r)},batchCreateComponent:function(e,t){for(var n=0;n<e.length;n+=1){var r=e[n];r.paintComponent!==!0&&(r.paintComponent=!1),r.parentElementId?r.parentDid=r.parentElementId:r.parent&&(r.parentDid=typeof parent!="string"?parent.getAttribute("d_id"):parent),r.before&&(r.beforeDid=typeof r.before!="string"?r.before.getAttribute("d_id"):r.before)}this.dataModel.batchCreateComponent(e,t)},deleteComponent:function(e,t,n){if(this.isDeleting)return;this.isDeleting=!0,t=t||{};var r=[];for(var i=0;i<e.length;i+=1){var s=e[i];typeof s!="string"&&(e[i]=s.domNode.getAttribute("d_id")),r.push($("*[d_id='"+e[i]+"']").getPath())}this.designer.removeSelections($.extend({ids:e},t)),n&&n(e),this.isDeleting=!1},set:function(e,t,n){typeof e!="string"&&(e=e.domNode.getAttribute("d_id"));for(var r in t)this.dataModel.setPropValue(e,r,t[r]);n&&n()},get:function(e,t){return typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.dataModel.getPropValue(e,t)},updateProperties:function(e,t,n,r){var i=[],s=[];e.each(function(){var e=this.getAttribute("d_id");if(e){i.push(e);var r={};s.push(r);if(t&&!n)for(var o=0;o<t.length;o+=1)r[t[o]]=this.getAttribute(t[o])||"";else{var u=this.attributes;for(var o=0;o<u.length;o+=1){var a=u[o].name;if(a.substring(0,2)=="d_"||a=="component"||a=="componentname"||a=="id")continue;if(n&&t&&$.inArray(a,t)!=-1)continue;var f=u[o].value;a=="class"&&f&&(f=f.replace("xui-hignlight-selected","")),r[a]=f}}}});for(var o=0;o<i.length;o+=1){var u=i[o],a=s[o];for(var f in a)this.dataModel.setPropValue(u,f,a[f])}r&&r()},updateNodes:function(e,t,n){var r=[],i=this;e.each(function(){var e=this.getAttribute("d_id"),n=i.dataModel.getModelElement(e);if(!n||n.length==0){var r=this.cloneNode(!0),s=i.asXml(r,t).join(""),o=i.dataModel.createElement({paintComponent:!1,templateContent:s,parentDid:$(this).attr("d_id"),beforeDid:$(this).next().attr("d_id")});updateDesignerAttr(o,this);var u=$(this);$(o).find("*").each(function(){var e=$("*[d_id='"+this.getAttribute("d_id")+"']",u)[0];e&&updateDesignerAttr(this,e)})}else{var a=this.attributes;for(var f in a){var l=a[f];if(l.value!==undefined){if(t&&$.inArray(l.name,t)!=-1)continue;n.attr(l.name,l.value)}}}}),n&&n()},updateText:function(e,t,n){var r={},i=this;e.each(function(){var e=$(this),n=this.childNodes;if(!n.length)return;var r=[];for(var s=0;s<n.length;s+=1){var o=n[s];o.nodeType==3&&r.push(o.nodeValue)}i.dataModel.setText(e.attr("d_id"),r.join(""),t)}),n&&n()},replaceChild:function(e,t,n,r){typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),n=n||{},this.dataModel.replaceChildren({did:e,templateContent:t,condition:n.jqCondition,callback:r})},repaintComponent:function(e,t){typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),this.designer.repaintComponent({did:e,callback:t})},move:function(e,t,n,r){typeof e!="string"&&(e=e.domNode.getAttribute("d_id")),t&&typeof t!="string"&&(t=t.domNode.getAttribute("d_id")),n&&typeof n!="string"&&(n=n.domNode.getAttribute("d_id")),this.dataModel.moveElement(e,t,n),r&&r()},getEditorDataSource:function(e,t,n){var r="";if(t=="xid"){var i=this.dataModel.getModelElementByXId(n);i.length>0&&(r=xmlUtil.toString(i[0])),t={xid:n}}else r=this.getNodeByDId(n);var s=(this.designer||this.mainModel).getFilePath();return xuiService.callService("getEditorDataSource",{async:!1,nodeXml:r,method:e,filePath:s,d_id:n,propertyItem:t||{}})}}),xuiService});